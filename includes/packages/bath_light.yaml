bath_light:
  script:
    light_turn_on_depending_on_daytime:
      sequence:
          #Включить свет
        - action: switch.turn_on
          #Если ночь, включить подсветку, если день включить основной свет
          data_template:
            entity_id: >
              {% if is_state("binary_sensor.is_night",  "on") %}
              switch.backlight_bath
              {% else %}
              switch.switch_bath_up
              {% endif %} 
#===================================================
  automation:
    - id: svet_v_vannoy_vkluchit_po_datchiku_dvizhenia
      alias: Свет в ванной включить по датчику движения
      triggers:
          #Обнаруживается движение
        - trigger: state
          entity_id: binary_sensor.motion_bath_occupancy
          to: "on"
      condition:
          #Если свет выключен
        - condition: template
          #Если ночь, то проверить подсветку, если день - основной свет
          value_template: > 
            {% if is_state("binary_sensor.is_night",  "on") %}
            {{ states ("switch.backlight_bath") == "off" }}
            {% else %}
            {{ states ("switch.switch_bath_up") == "off" }}
            {% endif %} 
      action:
          #Запустить скрипт включающий свет разной интенсивности в зависимости от времени суток
        - action: script.turn_on
          entity_id: script.light_turn_on_depending_on_daytime
  #===================================================
    - id: svet_v_vannoy_vikluchit_po_datchiku_dvizhenia
      alias: Свет в ванной выключить по датчику движения
      triggers:
          #Движение не обнаруживается
        - trigger: state
          entity_id: binary_sensor.motion_bath_occupancy
          to: "off"
      condition:
          #Если дверь открыта
        - condition: state
          entity_id: binary_sensor.door_bath_contact
          state: "on"
      action:
        #Выключить весь свет
        - action: switch.turn_off
          entity_id: 
            - switch.backlight_bath
            - switch.switch_bath_up
#===================================================
    - id: vkluchit_ventilaciyu_vruchnuyu
      alias: Выключить вентиляцию вручную
      triggers:
        - trigger: state
          entity_id: sensor.switch_bath_action
          to: "single_down" 
      conditions:
        - condition: state
          entity_id: switch.fan_bath
          state: "on"
      actions:
        - action: switch.turn_on
          entity_id: switch.fan_bath
#===================================================
    - id: vkluchit_ventilaciyu_avtomaticheski
      alias: Включить вентиляцию автоматически
      triggers:
        - trigger: state
          entity_id: binary_sensor.door_bath_contact
          to: "off" 
      conditions:
        - condition: state
          entity_id: binary_sensor.motion_bath_occupancy
          state: "on"
      actions:
        - action: switch.turn_on
          entity_id: switch.fan_bath
#===================================================
    - id: vykluchit_ventilaciyu_avtomaticheski
      alias: Выключить вентиляцию автоматически
      triggers:
        - trigger: state
          entity_id: binary_sensor.door_bath_contact
          to: "on" 
      # conditions:
      #   - condition: state
      #     entity_id: binary_sensor.motion_bath_occupancy
      #     state: "on"
      actions:
        - action: switch.turn_off
          entity_id: switch.fan_bath
#===================================================
